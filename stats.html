<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha1/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-GLhlTQ8iRABdZLl6O3oVMWSktQOp6b7In1Zl3/Jr59b6EGGoI1aFkw7cmDA6j6gD" crossorigin="anonymous">
  <title>Document</title>
</head>
<body>
  <div class="container">
    <div class="row mt-3">
      <div class="col-12 col-md-6">
        <h5 class="text-center text-uppercase fw-bold">Resident Camp</h5>
        <table class="table table-striped">
          <thead>
            <tr>
              <td>Week</td>
              <td>Youth</td>
              <td>Adult</td>
              <td>Total</td>
            </tr>
          </thead>
          <tbody id="trad"></tbody>
        </table>
      </div>
      <div class="col-12 col-md-6">
        <h5 class="text-center text-uppercase fw-bold">Paddlerama</h5>
        <table class="table table-striped">
          <thead>
            <tr>
              <td>Week</td>
              <td>Youth</td>
              <td>Adult</td>
              <td>Total</td>
            </tr>
          </thead>
          <tbody id="pad"></tbody>
        </table>
      </div>
    </div>
    <div class="row mt-3">
      <div class="col-12 col-md-6">
        <h5 class="text-center text-uppercase fw-bold">Webelos Week</h5>
        <table class="table table-striped">
          <thead>
            <tr>
              <td>Week</td>
              <td>Youth</td>
              <td>Adult</td>
              <td>Total</td>
            </tr>
          </thead>
          <tbody id="web"></tbody>
        </table>
      </div>
      <div class="col-12 col-md-6">
        <h5 class="text-center text-uppercase fw-bold">Totals</h5>
        <div class="row my-3">
          <div class="col">
            <div class="card">
              <div class="card-header">
                Total Youth
              </div>
              <div class="card-body">
                <h5 class="card-title fw-bold" id="total"></h5>
              </div>
            </div>
          </div>
          <div class="col">
            <div class="card">
              <div class="card-header">
                % of Goal
              </div>
              <div class="card-body">
                <h5 class="card-title fw-bold" id="percent"></h5>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>

  <style>
    thead, tr:last-child {
      font-weight: bold;
    }
  </style>


  <script>

    let overallYouthTotal = 0
    let goal = 2500

    async function getData(url) {
      try {
        // We are using fetch to get the response
        const response = await fetch(url);
        const data = await response.text();

        // Parse Table
        const parser = new DOMParser();
        const doc = parser.parseFromString(data, "text/html");
        const table = doc.querySelector('table');
        const rows = table.querySelectorAll("tr");
        const columns = [];

        // Iterate through rows
        for (let i = 0; i < rows.length; i++) {
          const cells = rows[i].querySelectorAll("td");
          // Iterate through cells
          for (let j = 0; j < cells.length; j++) {
            if (!columns[j]) {
              columns[j] = [];
            }
            columns[j][i] = cells[j].textContent;
          }
        }

        const youth = columns[1].slice(2)
        const adults = columns[2].slice(2)


        return({youth, adults})

      } catch (error) {
        console.log(error);
      }
    }

    async function fillTable6(url, selector){
      let session = await getData(url);

      const table = document.querySelector(selector);

      for (let i = 0; i < 6; i++)
      {
        const newRow = document.createElement("tr");

        const weekCell = document.createElement("td");
        const youthCell = document.createElement("td");
        const adultCell = document.createElement("td");
        const totalCell = document.createElement("td");

        weekCell.textContent = "Week " + (i+1);
        youthCell.textContent = session.youth[i]
        adultCell.textContent = session.adults[i]
        totalCell.textContent = (parseInt(session.youth[i]) + parseInt(session.adults[i]))

        newRow.appendChild(weekCell);
        newRow.appendChild(youthCell);
        newRow.appendChild(adultCell);
        newRow.appendChild(totalCell);

        table.appendChild(newRow);
      }

      const newRow = document.createElement("tr");

      const totalCell = document.createElement("td");
      const youthCell = document.createElement("td");
      const adultCell = document.createElement("td");
      const totalTotalCell = document.createElement("td");

      totalYouth = session.youth.reduce((partialSum, a) => partialSum + parseInt(a), 0);
      totalAdults = session.adults.reduce((partialSum, a) => partialSum + parseInt(a), 0);

      totalCell.textContent = "TOTAL";
      youthCell.textContent = totalYouth;
      adultCell.textContent = totalAdults;
      totalTotalCell.textContent = (totalYouth + totalAdults)
      overallYouthTotal += totalYouth

      newRow.appendChild(totalCell);
      newRow.appendChild(youthCell);
      newRow.appendChild(adultCell);
      newRow.appendChild(totalTotalCell);

      table.appendChild(newRow);
    }

    async function fillTable1(url, selector) {
      let session = await getData(url);

      const table = document.querySelector(selector);

      for (let i = 0; i < 1; i++) {
        const newRow = document.createElement("tr");

        const weekCell = document.createElement("td");
        const youthCell = document.createElement("td");
        const adultCell = document.createElement("td");
        const totalCell = document.createElement("td");

        weekCell.textContent = "Week 6";
        youthCell.textContent = session.youth[i]
        adultCell.textContent = session.adults[i]
        totalCell.textContent = (parseInt(session.youth[i]) + parseInt(session.adults[i]))

        newRow.appendChild(weekCell);
        newRow.appendChild(youthCell);
        newRow.appendChild(adultCell);
        newRow.appendChild(totalCell);

        table.appendChild(newRow);
      }

      const newRow = document.createElement("tr");

      const totalCell = document.createElement("td");
      const youthCell = document.createElement("td");
      const adultCell = document.createElement("td");
      const totalTotalCell = document.createElement("td");

      totalYouth = session.youth.reduce((partialSum, a) => partialSum + parseInt(a), 0);
      totalAdults = session.adults.reduce((partialSum, a) => partialSum + parseInt(a), 0);

      totalCell.textContent = "TOTAL";
      youthCell.textContent = totalYouth;
      adultCell.textContent = totalAdults;
      totalTotalCell.textContent = (totalYouth + totalAdults)

      newRow.appendChild(totalCell);
      newRow.appendChild(youthCell);
      newRow.appendChild(adultCell);
      newRow.appendChild(totalTotalCell);

      table.appendChild(newRow);
    }

    async function main(){
      await fillTable6('https://247scouting.com/api.php?o=BSA525&a=registration_count&v=61822', '#trad');
      await fillTable6('https://247scouting.com/api.php?o=BSA525&a=registration_count&v=60010', '#pad');
      await fillTable1('https://247scouting.com/api.php?o=BSA525&a=registration_count&v=62860', '#web');

      const totalCell = document.querySelector('#total')
      totalCell.textContent = overallYouthTotal;

      const percentCell = document.querySelector('#percent')
      percentCell.textContent = overallYouthTotal/goal*100 + "%";
    }

    main()

  </script>
</body>
</html>
